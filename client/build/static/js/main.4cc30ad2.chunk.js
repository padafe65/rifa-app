(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(e,a,t){e.exports=t(42)},41:function(e,a,t){},42:function(e,a,t){"use strict";t.r(a);var r=t(0),n=t.n(r),l=t(17),o=t.n(l),s=t(2),c=t(5),m=t(43);const i="https://rifa-app-ie5r.onrender.com",u=Object(r.createContext)(),d=e=>{let{children:a}=e;const[t,l]=Object(r.useState)(localStorage.getItem("authToken")||null),[o,s]=Object(r.useState)(localStorage.getItem("userRole")||null),[c,d]=Object(r.useState)(()=>{const e=localStorage.getItem("usuario");return e?JSON.parse(e):null});Object(r.useEffect)(()=>{console.log("\ud83d\udd04 Cargando usuario desde localStorage...");const e=localStorage.getItem("usuario");e&&!c&&(d(JSON.parse(e)),console.log("\u2705 Usuario restaurado desde localStorage:",JSON.parse(e)))},[]),Object(r.useEffect)(()=>{t?(localStorage.setItem("authToken",t),localStorage.setItem("userRole",o),localStorage.setItem("usuario",JSON.stringify(c))):(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("usuario"))},[t,o,c]);return n.a.createElement(u.Provider,{value:{authToken:t,userRole:o,usuario:c,login:async e=>{try{const t=await m.a.post(`${i}/api/auth/login`,e);return l(t.data.token),s(t.data.role),d(t.data.usuario),console.log("\u2705 Usuario almacenado en AuthContext:",t.data.usuario),!0}catch(a){return console.error("Error en login:",a),!1}},logout:()=>{l(null),s(null),d(null),localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("usuario")}}},a)},b=()=>Object(r.useContext)(u);var p=()=>{const{authToken:e,logout:a}=b();return Object(r.useEffect)(()=>{console.log("\ud83d\udd04 Cambios en authToken:",e)},[e]),console.log("\ud83e\udde0 authToken en Navbar:",e),n.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark"},n.a.createElement("div",{className:"container"},n.a.createElement(c.b,{className:"navbar-brand",to:"/"},"Rifa"),n.a.createElement("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},n.a.createElement("span",{className:"navbar-toggler-icon"})),n.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav"},n.a.createElement("ul",{className:"navbar-nav me-auto"},e?n.a.createElement(n.a.Fragment,null,n.a.createElement("li",{className:"nav-item"},n.a.createElement(c.b,{className:"nav-link",to:"/rifa"},"Jugar")),n.a.createElement("li",{className:"nav-item"},n.a.createElement(c.b,{className:"nav-link",to:"/admin"},"Administraci\xf3n")),n.a.createElement("li",{className:"nav-item"},n.a.createElement("button",{className:"btn btn-danger ms-3",onClick:a},"Cerrar sesi\xf3n"))):n.a.createElement(n.a.Fragment,null,n.a.createElement("li",{className:"nav-item"},n.a.createElement(c.b,{className:"nav-link",to:"/"},"Iniciar Sesi\xf3n")),n.a.createElement("li",{className:"nav-item"},n.a.createElement(c.b,{className:"nav-link",to:"/registro"},"Registrarse")))))))},g=t(23),E=t.n(g),h=t(7),v=t.n(h),f=t(8),N=t.n(f);const y=N()(v.a);var S=()=>{const[e,a]=Object(r.useState)({email:"",password:""}),{login:t}=b(),l=Object(s.q)(),o=Object(r.useRef)(null),c=t=>{a({...e,[t.target.name]:t.target.value})};return n.a.createElement("div",{className:"container mt-5"},n.a.createElement("h2",null,"Iniciar Sesi\xf3n"),n.a.createElement("div",{className:"float-end mb-3 text-muted",style:{cursor:"pointer"},onClick:()=>{l("/reset-password")}},"\xbfOlvidaste tu contrase\xf1a?"),n.a.createElement("div",{className:"clearfix"}),n.a.createElement("form",{onSubmit:async a=>{a.preventDefault(),await t(e)?y.fire({icon:"success",title:"Inicio de sesion exitoso",html:n.a.createElement("i",null,"El usuario con email:",n.a.createElement("strong",null," ",e.email," "),"fue validado con exito"),imageUrl:"img/bienvenido.gif",imageWidth:100,imageHeight:100,confirmButtonColor:"#198754"}).then(()=>{l("/rifa")}):alert("Correo o contrase\xf1a incorrectos")}},n.a.createElement("input",{type:"email",name:"email",placeholder:"Correo electr\xf3nico",onChange:c,className:"form-control mb-2",required:!0}),n.a.createElement("input",{type:"password",name:"password",placeholder:"Contrase\xf1a",onChange:c,className:"form-control mb-2",required:!0}),n.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Ingresar")),n.a.createElement(E.a,{nodeRef:o},n.a.createElement("div",{ref:o,style:{width:"950px",padding:"10px",backgroundColor:"#17a2b8",color:"white",borderRadius:"10px",position:"absolute",top:"300px",right:"130px",cursor:"move",zIndex:1e3}},n.a.createElement("img",{src:"/img/jesus.jpg",alt:"Imagen de Jesus mi salvador",style:{width:"10%",height:"auto",borderRadius:"8px",marginBottom:"10px"}}),n.a.createElement("p",null,"\ud83d\udca1",n.a.createElement("i",null,n.a.createElement("strong",{style:{color:"beige"}},"Bienvenido y gracias por participar en la rifa pro_quimioterapia Erwin.")),'Para entrar a nuestra p\xe1gina y participar en la rifa de $500000 COP (Quinientos mil pesos colombianos), la cual funciona de la manera siguiente: participas con el n\xfamero de cuatro cifras generado por el bot\xf3n "Generar N\xfamero" y esta es la cantidad que debes pagar, por ejemplo, si se genera el n\xfamero "0214" cancelas $214 COP y si deseas participar con m\xe1s n\xfameros, da clic en el bot\xf3n nuevamente, si te sale "1026", cancelas en total la suma de los dos n\xfameros: $1240 COP. ',n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("strong",null,"Tenga en cuenta:")," ",n.a.createElement("br",null),"1. Debes registrar tu usuario y proporcionar los datos solicitados.",n.a.createElement("br",null),"2. Iniciar sesi\xf3n con tu correo y la clave que seleccionaste.",n.a.createElement("br",null),"3. Todo n\xfamero/s de la rifa debe estar cancelado para el pago del premio y se debe subir el comprobante de pago al n\xfamero ",n.a.createElement("strong",null,"3142999274")," a nombre de ",n.a.createElement("strong",null,"Vilma"),".",n.a.createElement("br",null),"4. Las oportunidades para ganar son proporcionales a los n\xfameros generados."))))};const C=N()(v.a);var O=()=>{const[e,a]=Object(r.useState)({nombre:"",telefono:"",email:"",password:"",rol:"usuario"}),t=Object(s.q)(),l=t=>{const{name:r,value:n}=t.target,l={...e,[r]:n};"Padafe65"===l.nombre&&"Pdve4461"===l.password?l.rol="admin":l.rol="usuario",a(l)};return n.a.createElement("div",{className:"container mt-5"},n.a.createElement("h2",null,"Registro de Usuario"),n.a.createElement("form",{onSubmit:async a=>{a.preventDefault();try{await m.a.post("http://localhost:5000/api/auth/register",e),C.fire({icon:"success",title:"Registro exitoso",text:"Usuario registrado con \xe9xito",confirmButtonColor:"#198754"}).then(()=>{t("/")})}catch(l){var r,n;C.fire({icon:"error",title:"Error en el registro",text:(null===(r=l.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.message)||"No se pudo registrar el usuario",confirmButtonColor:"#dc3545"})}}},n.a.createElement("input",{type:"text",name:"nombre",placeholder:"Nombre",onChange:l,className:"form-control mb-2",required:!0}),n.a.createElement("input",{type:"text",name:"telefono",placeholder:"telefono fijo o celular",onChange:l,className:"form-control mb-2",required:!0}),n.a.createElement("input",{type:"email",name:"email",placeholder:"Correo Electr\xf3nico",onChange:l,className:"form-control mb-2",required:!0}),n.a.createElement("input",{type:"password",name:"password",placeholder:"Contrase\xf1a",onChange:l,className:"form-control mb-2",required:!0}),n.a.createElement("div",{className:"mb-3"},n.a.createElement("label",{className:"form-label"},"Rol asignado:"),n.a.createElement("input",{type:"text",value:e.rol,className:"form-control",readOnly:!0})),n.a.createElement("button",{type:"submit",className:"btn btn-success"},"Registrar")))};t(22);var j=()=>{const[e,a]=Object(r.useState)([]),[t,l]=Object(r.useState)(0),[o,s]=Object(r.useState)([]),{usuario:c,userRole:i}=b(),[u,d]=Object(r.useState)(!0),[p,g]=Object(r.useState)(null),[E,h]=Object(r.useState)({}),[v,f]=Object(r.useState)({}),[N,y]=Object(r.useState)({}),S=Object(r.useCallback)(async()=>{try{let a;a="admin"===(null===c||void 0===c?void 0:c.rol)?await m.a.get("http://localhost:5000/api/rifas"):await m.a.get(`http://localhost:5000/api/rifa/listar/${c.id}`),s(a.data)}catch(e){console.error("Error al cargar rifas:",e)}},[i,null===c||void 0===c?void 0:c.id]);Object(r.useEffect)(()=>{c&&(S(),d(!1))},[c,S]);return n.a.createElement("div",{className:"container mt-5"},n.a.createElement("h2",null,"Participar en la Rifa"),n.a.createElement("button",{className:"btn btn-success",onClick:()=>{const r=Math.floor(1e4*Math.random()).toString().padStart(4,"0");a([...e,r]),l(t+parseInt(r,10))}},"Generar N\xfamero"),n.a.createElement("button",{className:"btn btn-primary ms-2",onClick:async()=>{if(console.log("Estado actual:",c),0!==e.length)try{console.log("\ud83d\udce4 Enviando datos al servidor:",{usuario_id:c.id,numeros:e,totalPago:t});const n=await m.a.post("http://localhost:5000/api/rifa/guardar",{usuario_id:c.id,numeros:e,totalPago:t});alert(n.data.message),a([]),l(0),S()}catch(r){console.error("Error al guardar n\xfameros:",r),alert("Hubo un error al guardar los n\xfameros.")}else alert("Debes generar al menos un n\xfamero antes de guardar.")}},"Guardar N\xfameros"),n.a.createElement("div",{className:"mt-3"},n.a.createElement("h4",null,"N\xfameros Jugados:"),e.map((e,a)=>n.a.createElement("span",{key:a,className:"badge bg-primary me-2"},e))),n.a.createElement("h3",null,"Total a pagar: $",(e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))(t)),t<1e3&&n.a.createElement("p",{className:"text-danger"},"Por favor jugar almennos un o unos n\xfameros m\xe1s  hasta alcanzar una suma de los n\xfameros juagados igual o mayor a  $1000 pesos si lo desea"),n.a.createElement("h3",null,"Rol detectado: ",c.rol),n.a.createElement("h3",null,"Usuario en la sesi\xf3n: ",c.nombre),n.a.createElement("h3",null,"Id Usuario: ",c.id),n.a.createElement("h2",{className:"mt-5"},"Historial de Rifas"),n.a.createElement("table",{className:"table table-bordered table-striped table-hover text-center align-middle"},n.a.createElement("thead",null,n.a.createElement("tr",{style:{backgroundColor:"#198754",color:"white",textAlign:"center"}},n.a.createElement("th",null,"Id rifa"),n.a.createElement("th",null,"Usuario"),n.a.createElement("th",null,"Usuario Id"),n.a.createElement("th",null,"N\xfameros"),n.a.createElement("th",null,"Total"),n.a.createElement("th",null,"Estado"),n.a.createElement("th",null,"Fecha"),n.a.createElement("th",null,"Acciones"),n.a.createElement("th",null,"Imagen"))),n.a.createElement("tbody",null,o.map(e=>n.a.createElement("tr",{key:e.id,style:{backgroundColor:"red",color:"white",fontSize:16,textAlign:"center",verticalAlign:"middle"}},n.a.createElement("td",null,e.id),n.a.createElement("td",null,e.nombre_usuario||c.nombre),n.a.createElement("td",null,e.usuario_id||"No disponible"),n.a.createElement("td",null,JSON.parse(e.numeros).join(", ")),n.a.createElement("td",null,"$",e.monto_total),n.a.createElement("td",null,e.estado),n.a.createElement("td",null,e.fecha),n.a.createElement("td",null,"Debe"===e.estado&&p!==e.id&&n.a.createElement("button",{className:"btn btn-warning btn-sm",onClick:()=>(e=>{g(e)})(e.id)},"Pagar"),"Debe"===e.estado&&p===e.id&&n.a.createElement(n.a.Fragment,null,n.a.createElement("input",{type:"file",accept:"image/*",className:"form-control mb-2",onChange:a=>((e,a)=>{const t=e.target.files[0];h(e=>({...e,[a]:t}))})(a,e.id)}),n.a.createElement("button",{className:"btn btn-success btn-sm",onClick:()=>(async e=>{const a=E[e];if(!a)return void f(a=>({...a,[e]:"\u274c Debes seleccionar una imagen primero."}));const t=new FormData;t.append("imagen",a);try{await m.a.post(`http://localhost:5000/api/subir-comprobante/${e}`,t),f(a=>({...a,[e]:"\u2705 Comprobante subido con \xe9xito."})),y(a=>({...a,[e]:!0})),S(),g(null)}catch(r){console.error("Error al subir el comprobante:",r),f(a=>({...a,[e]:"\u274c Hubo un error al subir el comprobante."}))}})(e.id)},"Subir Comprobante")),"Cancelado"===e.estado&&e.imagen_pago&&n.a.createElement("a",{href:`http://localhost:5000/uploads/${e.imagen_pago}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-info btn-sm"},"Ver Comprobante")),n.a.createElement("td",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},e.imagen_pago?n.a.createElement("img",{src:`http://localhost:5000/uploads/${e.imagen_pago}`,alt:"Comprobante",width:60,height:55,style:{alignItems:"center",paddingLeft:3}}):n.a.createElement("span",{style:{fontSize:"0.8rem",color:"gray"}},"Sin comprobante")))))))};var w=()=>{const{authToken:e,userRole:a}=b(),[t,l]=Object(r.useState)([]),o=Object(s.q)();return Object(r.useEffect)(()=>{"admin"===a?(async()=>{try{const t=await m.a.get("http://localhost:5000/api/admin/users",{headers:{Authorization:`Bearer ${e}`}});l(t.data)}catch(a){console.error("Error al obtener usuarios:",a)}})():o("/")},[e,a,o]),n.a.createElement("div",{className:"container mt-5"},n.a.createElement("h2",null,"Panel de Administraci\xf3n"),n.a.createElement("table",{className:"table table-bordered"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"ID"),n.a.createElement("th",null,"Usuario"),n.a.createElement("th",null,"Rol"))),n.a.createElement("tbody",null,t.map(e=>n.a.createElement("tr",{key:e.id},n.a.createElement("td",null,e.id),n.a.createElement("td",null,e.username),n.a.createElement("td",null,e.role))))))};t(41);const k=N()(v.a);var x=()=>{const[e,a]=Object(r.useState)(""),[t,l]=Object(r.useState)(""),[o,c]=Object(r.useState)(""),i=Object(s.q)();return n.a.createElement("div",{className:"container mt-5"},n.a.createElement("h3",null,"Reestablecer Contrase\xf1a"),n.a.createElement("form",{onSubmit:async a=>{a.preventDefault();try{const a=await m.a.post("https://rifa-app-ie5r.onrender.com/api/auth/reestablecer-password",{email:e,nuevaPassword:t});a&&(k.fire({icon:"success",title:a.data.message,html:n.a.createElement("i",null,"El usuario con email:",n.a.createElement("strong",null," ",e," "),"fue validado y la contrase\xf1a actualizda"),confirmButtonColor:"#198754"}).then(()=>{i("/")}),c(a.data.message))}catch(u){var r,l,o,s;console.error("\u274c Error al reestablecer la contrase\xf1a:",u);const e=(null===(r=u.response)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.message)||(null===(o=u.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.error)||"Ocurri\xf3 un error inesperado al intentar cambiar la contrase\xf1a.";c(e)}}},n.a.createElement("input",{type:"email",placeholder:"Correo registrado",className:"form-control mb-2",value:e,onChange:e=>a(e.target.value),required:!0}),n.a.createElement("input",{type:"password",placeholder:"Nueva contrase\xf1a",className:"form-control mb-2",value:t,onChange:e=>l(e.target.value),required:!0}),n.a.createElement("button",{className:"btn btn-warning"},"Reestablecer")),o&&n.a.createElement("div",{className:"mt-3 alert alert-info"},o))};function I(e){let{children:a}=e;const{authToken:t}=b();return t?a:n.a.createElement(s.a,{to:"/",replace:!0})}var R=function(){return n.a.createElement(d,null,n.a.createElement(c.a,null,n.a.createElement(p,null),n.a.createElement("div",{className:"container"},n.a.createElement(s.d,null,n.a.createElement(s.b,{path:"/",element:n.a.createElement(S,null)}),n.a.createElement(s.b,{path:"/registro",element:n.a.createElement(O,null)}),n.a.createElement(s.b,{path:"/rifa",element:n.a.createElement(I,null,n.a.createElement(j,null))}),n.a.createElement(s.b,{path:"/admin",element:n.a.createElement(I,null,n.a.createElement(w,null))}),n.a.createElement(s.b,{path:"*",element:n.a.createElement(s.a,{to:"/",replace:!0})}),n.a.createElement(s.b,{path:"/reset-password",element:n.a.createElement(x,null)})))))};var P=e=>{e&&e instanceof Function&&t.e(3).then(t.bind(null,44)).then(a=>{let{getCLS:t,getFID:r,getFCP:n,getLCP:l,getTTFB:o}=a;t(e),r(e),n(e),l(e),o(e)})};o.a.createRoot(document.getElementById("root")).render(n.a.createElement(d,null,n.a.createElement(R,null))),P()}},[[24,1,2]]]);
//# sourceMappingURL=main.4cc30ad2.chunk.js.map